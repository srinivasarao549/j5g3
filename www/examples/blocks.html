<html>
<head>
	<title>JSGE - Blocks Game</title>
	<script src="../../build/j5g3.js"></script>
	<script src="../../src/Debug.js"></script>
<script>
function game($)
{
var
	// CONSTANTS
	BLOCK_WIDTH = 24,
	BLOCK_HEIGHT= 24,
	BLOCK_PIECES= 7,
	BLOCK_COLORS=4,

	// Our Spritesheet
	ss = $.spritesheet('spritesheet')
	      .push(0,130,48,48)
	      .push(0,15,48,48)
	      .push(0,15,48,48)
	      .push(0,15,48,48)
	      .push(0,15,48,48)
	,
	get_map = function(piece, c)
	{
		switch (piece) {
		case 0: return [[c],[c],[c,c]];
		case 1: return [[c],[c],[c],[c]];
		case 2: return [[c],[c,c],[c]];
		case 3: return [[c,c],[c,c]];
		case 4: return [[0,c],[0,c],[c,c]];
		case 5: return [[0,c],[c,c],[c]];
		case 6: return [[c],[c,c],[0,c]];
		}
	},
	// Creates a new map object based on the template and color specified
	piece = function(template, color)
	{
		var result = $.map({ sprites: ss.sprites(), map: get_map(template, color), tw: BLOCK_WIDTH, th: BLOCK_HEIGHT}); 
		return result;		
	},

	get_next = function()
	{
		return piece(Math.floor(Math.random()*BLOCK_PIECES), Math.ceil(Math.random()*BLOCK_COLORS));
	},

	background = $.image('background'),
	next = get_next().pos(48,48),
	board= $.clip().pos(200, 48),
	current = get_next(),

	gravity = function() {
		current.__y = (current.__y + 1);
	},
	keyboard = function(evt) {
		switch(evt.keyCode) {
		case 38: rotate(); break;
		case 37: left(); break;
		case 39: right(); break;
		case 40: down(); break;
		}
	},
	speed = 250
;
	board.add(current);
	setInterval(gravity, speed);
	window.addEventListener('keypress', keyboard);

	$.background.fillStyle('#006');
	$.root.add([background, next, board]);
	$.run();
}
</script>
	<link rel="stylesheet" href="styles.css" />
</head>
<body onload="j5g3.start(game);">
	<h1>Blocks</h1>
	<canvas id="screen"></canvas>
	<h2>Instructions</h2>
	<div id="assets"> 
		<img id="spritesheet" src="blocks-ss.png" />
		<img id="background" src="light.png">
	</div>
</body>
