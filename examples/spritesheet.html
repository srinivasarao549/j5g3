<script src="../build/j5g3.js"></script>
<script src="../src/Debug.js"></script>
<script src="../src/Monkey.js"></script>
<script>
function game($)
{
	var ROWS = 4, COLS=4,
	    ss = $.spritesheet($.id('pic')).grid(ROWS, COLS),
	    pieces= ss.sprites(),
	    r, c,
	    w=$.canvas().width / COLS,
	    h=$.canvas().height / ROWS,
	    last = pieces[8]
	;

	pieces.shuffle();

	for (r=0; r<ROWS; r++)
		for (c=0; c<COLS; c++)
			pieces[r*COLS+c].pos(c*w, r*h).width(w-4).height(h-4);

	pieces.splice(pieces.indexOf(last), 1);

	$.canvas().onmousemove = function(evt)
	{
		pieces.each(function() { this.alpha(1); });
		var piece = $.root.at(evt.offsetX, evt.offsetY);
		if (piece) piece.alpha(0.5);
	};

	var onclick = $.canvas().onclick = function(evt)
	{
		$.canvas().onclick = null;
		var piece = $.root.at(evt.offsetX, evt.offsetY);

		if (piece)
		{
		    var x = piece.x(), y = piece.y(),
		    tween;
		// decide where to move
			if (x > 0 && !$.root.at(x-4,y+4))
				tween = $.tween(piece).to({x: piece.x()-w});
			else if (y > 0 && !$.root.at(x+4,y-4))
				tween = $.tween(piece).to({y: piece.y()-h});
			else if (y < h*(ROWS-1) && !$.root.at(x+4, y+h))
				tween = $.tween(piece).to({y: piece.y()+h});
			else if (x < w*(COLS-1) && !$.root.at(x+w, y+4))
				tween = $.tween(piece).to({x: piece.x()+w});

			tween.on_remove(function() { $.canvas().onclick = onclick; });
			$.root.add(tween.auto_remove(true).duration(16));
		}
		else return $.canvas().onclick = onclick;

	}

	$.background.fillStyle('black');
	$.root.add(pieces);
	$.run();
}
</script>
<style>
	canvas { border: 4px solid black; width: 500px; height: 400px; }
	#assets { display:none;}
	#thumb { float: right; border: 1px solid #ccc; }
</style>

<body onload="j5g3.start({ start: game, width: 500, height: 400});" style="width: 800px; margin: 10px auto;">
	<h1>Spritesheet Demo</h1>
	<label>Enter Image URL: <input id="img"> <button onclick="load">Load</button> </label>
	<canvas id="screen"></canvas>
	<img width="280" src="sn.jpg" id="thumb"/>
	<div id="assets">
		<img src="sn.jpg" id="pic"/>
	</div>
		
</body>
