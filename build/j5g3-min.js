(function(h,I,s){var m,z,k,n,t,j,A,o,B,p,C,D,u,v,q,E,F,G,H,w,g,l,f,e=h.j5g3=new (function(){var a=this,b=arguments.callee,c=31;this.run=function(){setInterval(this.gameLoop,c)};this.gameLoop=function(){a.background.draw();a.root.draw()};this.fps=function(d){return d===s?1E3/c:(c=1E3/d,this)};this.start=function(d){d=typeof d=="function"?{start:d}:d;k.properties.apply(b,[{canvas:null,backgroundStyle:"black",width:640,height:480}]);g(a,d);a.canvas()===null&&a.canvas(e.id("screen"));w=a.canvas();a.background=
new u({fillStyle:a.backgroundStyle(),width:a.width(),height:a.height()});a.root=new n({width:a.width(),height:a.height()});w.width=a.width();w.height=a.height();f=w.getContext("2d");d.start(e,I)};this.invalidate=function(){return this};this.id=function(d){return I.getElementById(d)}});h.Class=function(){};h.Class.extend=function(a){var b,c=a.init?a.init:function(){arguments.callee.prototype.__super.apply(this,arguments)};c.prototype=new this;for(b in a)if(this[b]!=a[b])c.prototype[b]=a[b];c.properties=
h.Class.properties;c.extend=h.Class.extend;c.prototype.__super=this;return c};h.property=function(a){var b="__"+a;return function(c){return c===s?this[b]:(this[b]=c,this)}};h.property.read=function(a){var b="__"+a;return function(){return this[b]}};h.Class.properties=function(a){var b;for(b in a)if(a[b]!==this[b]){this.prototype[b]=h.property(b);this.prototype["__"+b]=a[b]}return this};k=h.Class;z={Easing:{None:function(a,b,c){var d=this.from();b=(b-d[a])/this.duration();return d[a]+b*c},RegularOut:function(){return 0}}};
t={Point:function(a,b){var c=this.x(),d=this.y();return a>=c&&a<=c+this.width()&&b>=d&&b<=d+this.height()},Circle:function(a){var b=this.x()-a.x();a=this.y()-a.y();var c=this.width();if(Math.abs(b)>c||Math.abs(a)>c)return false;return b*b+a*a<=c*c},AABB:function(a){var b=this.x(),c=this.y(),d=a.x(),r=a.y();return b+this.width()>=d&&b<=d+a.width()&&c+this.height()>r&&c<=r+a.height()}};g=function(a,b){var c;for(c in b)a["__"+c]=b[c];return a};H={extend:function(a,b){for(var c in b)a[c]=b[c];return a},
inherit:function(a,b){for(var c in b)a[c]=a[c]||b[c];return a},clone:function(a){var b={};for(var c in a)b[c]=a[c];return b}};l=H.getType=function(a){var b=typeof a;if(b=="object"){if(a instanceof Array)return"array";if(a instanceof HTMLAudioElement)return"audio";if(a instanceof HTMLElement)return"DOM";if(a.init)return"j5g3"}return b};o={Void:function(){},Image:function(){f.drawImage(this.__source,0,0)},Sprite:function(){var a=this.source(),b=this.width(),c=this.height();f.drawImage(a.image,a.x,a.y,
a.w,a.h,0,0,b?b:a.w,c?c:a.h)},Container:function(){var a=this.frame(),b=0,c=a.length;for(b=0;b<c;b++)a[b].draw()},Text:function(){f.fillText(this.text(),0,0)}};j=k.extend({init:function(a){g(this,a);this._dirty=true},begin:function(){f.save();f.globalAlpha*=this.alpha();f.translate(this.x(),this.y());f.scale(this.scaleX(),this.scaleY());f.rotate(this.rotation())},end:function(){f.restore()},draw:function(){this.begin();this.paint();this.end()},invalidate:function(){this._dirty=true;return this},is_dirty:function(){return this._dirty},
align:function(a,b){switch(a){case "center":this.x(b.width()/2);break;case "left":this.x(0);break;case "right":this.x(b.width()-this.width());break;case "middle":this.y(b.height()/2);break}return this},collides:t.Circle,pos:function(a,b){this.__x=a;this.__y=b;return this.invalidate()},size:function(a,b){this.__width=a;this.__height=b;return this.invalidate()},scale:function(a,b){this.scaleX(a);return this.scaleY(b)},remove:function(){this.parent().remove_child(this)},visible:function(){return this.__alpha>
0}}).properties({source:null,parent:null,x:0,y:0,width:null,height:null,rotation:0,scaleX:1,scaleY:1,alpha:1});n=j.extend({init:function(a){g(this,a);if(!this.__frames)this.__frames=[[]];this._frame=0;this._playing=true},frame:function(){var a=this.frames()[this._frame];this._playing&&this.nextFrame();return a},nextFrame:function(){this._frame=this._frame<this.__frames.length-1?this._frame+1:0},paint:o.Container,stop:function(){this._playing=false},play:function(){this._playing=true},add:function(a){switch(l(a)){case "function":a=
new m(a);break;case "string":a=new p({source:a});break;case "object":a=new p(a);break;case "array":for(var b=0;b<a.length;b++)this.add(a[b]);return this;case "audio":a={parent:h.property("parent"),draw:function(){a.play()}};break}a.parent(this);b=this.frames();b[b.length-1].push(a);return this},go:function(a){this._frame=a;return this},alignChildren:function(a){for(var b=this.frame(),c=b.length;c--;)b[c].align&&b[c].align(a,this);return this},at:function(a,b){var c=this.frame(),d;for(d=0;d<c.length;d++)if(c[d].visible()&&
t.Point.apply(c[d],[a,b]))return c[d]},remove_child:function(a){var b=this.frames(),c,d;for(c=0;c<b.length;c++)if(d=b[c].indexOf(a)){b.splice(d,1);return this.invalidate()}}}).properties({frames:null});B=n.extend({paint:function(){var a=e.clip();a.add(this.source());a.frames().length=this.life();a.frames().push([m.remove]);this.add(a);this.__on_emit&&this.__on_emit(a)}}).properties({source:null,life:10,on_emit:null});p=j.extend({init:function(a){switch(l(a)){case "string":a={source:e.id(a)};break;
case "DOM":a={source:a};break}g(this,a);this.__source&&this.source(this.__source)},paint:o.Image,source:function(a){if(a){this.__source=typeof a=="string"?e.id(a):a;this.__width===null&&this.width(this.__source.width);this.__height===null&&this.height(this.__source.height);this.invalidate();return this}return this.__source}});D=k.extend({init:function(a,b){if(typeof a!="object")a={start:a,end:b};g(this,a)},to_a:function(){for(var a=this.__start,b=[],c=this.end();a<c;a++)b.push(a);return b}}).properties({start:0,
end:0});v=j.extend({begin:function(){j.prototype.begin.apply(this);if(this.__fillStyle)f.fillStyle=this.__fillStyle;if(this.__strokeStyle)f.strokeStyle=this.__strokeStyle;if(this.__lineWidth)f.lineWidth=this.__lineWidth;if(this.__lineCap)f.lineCap=this.__lineCap;if(this.__lineJoin)f.lineJoin=this.__lineJoin;if(this.__miterLimit)f.miterLimit=this.__miterLimit}}).properties({fillStyle:0,strokeStyle:0,lineWidth:0,lineCap:0,lineJoin:0,miterLimit:0});u=v.extend({paint:function(){f.fillRect(this.__x,this.__y,
this.__width,this.__height)}});A=v.extend({init:function(a){if(typeof a!="object")a={lineWidth:a};g(this,a)},paint:function(){f.strokeRect(this.x(),this.y(),1,1)}}).properties({lineCap:"round",lineJoin:"round"});C=k.extend({init:function(a){g(this,a)},draw:function(){var a=this.__obj,b=this.__v;a.x(a.x()+b[0]);a.y(a.y()+b[1])},force:function(a,b){var c=this.__m,d=this.__v;d[0]=(c*d[0]+a)/c;d[1]=(c*d[1]+b)/c;return this},impulse:function(){},invalidate:function(){}}).properties({obj:null,v:null,m:1,
parent:null});q=j.extend({init:function(a){g(this,a)},paint:o.Sprite});E=k.extend({init:function(a){switch(l(a)){case "string":case "DOM":case "j5g3":a={source:a}}switch(l(a.source)){case "string":case "DOM":a.source=new p(a.source);break}if(a.width===s&&a.source)a.width=a.source.width();if(a.height===s&&a.source)a.height=a.source.height();a=g(this,a);a.__sprites=a.__sprites||[]},clip:function(){return this.clip_array(arguments)},clip_array:function(a){var b=this.sprites(),c=[],d;for(d=0;d<a.length;d++)c.push([b[a[d]]]);
return new n({frames:c})},clip_range:function(a){return this.clip_array(a.to_a())},cut:function(a,b,c,d){a=new q(l(a)=="object"?{width:a.w,height:a.h,source:{image:this.source().source(),x:a.x,y:a.y,w:a.w,h:a.h}}:{width:c,height:d,source:{image:this.source().source(),x:a,y:b,w:c,h:d}});this.__sprites.push(a);return a},grid:function(a,b){var c=this.__sprites=[],d=this.width()/a,r=this.height()/b,x,y,K=this.source().source();for(x=0;x<b;x++)for(y=0;y<a;y++)c.push(new q({source:{image:K,x:y*d,y:x*r,
w:d,h:r}}));return this}}).properties({width:0,height:0,source:null,sprites:null,cols:1,rows:1,type:"grid"});var J;F=j.extend({init:function(a){if(typeof a=="string")a={text:a};g(this,a)},begin:function(){J.apply(this);if(this.__fillStyle)f.fillStyle=this.__fillStyle;if(this.__font)f.font=this.__font},paint:o.Text,width:function(){this.begin();var a=f.measureText(this.text());this.end();return a.width}}).properties({text:"",fillStyle:"white",font:null});J=j.prototype.begin;G=k.extend({init:function(a){if(l(a)==
"j5g3")a={target:a};this.draw=this.start;g(this,a)},pause:function(){this._olddraw=this.draw;this.draw=function(){};return this},resume:function(){this.draw=this._olddraw?this._olddraw:this.start;return this},rewind:function(){this.__repeat-=1;return this.t(0)},stop:function(){this.pause();this.rewind();this.__on_stop&&this.__on_stop();return this},easing:z.Easing.None,remove:function(){this.parent().remove_child(this);this.__on_remove&&this.__on_remove();return this},_calculate:function(){var a=
this.target(),b,c=this.to(),d=this.t();for(b in c)a[b](this.easing(b,c[b],d));if(d<this.duration())this.t(d+1);else if(this.auto_remove())this.remove();else this.repeat()?this.rewind():this.stop()},start:function(){var a=this.to(),b,c=this.target();if(this.__from===null){this.__from={};for(b in a)this.__from[b]=c[b]()}this.draw=this._calculate},draw:null,invalidate:function(){return this}}).properties({auto_remove:false,repeat:Infinity,duration:100,parent:null,is_playing:false,from:null,target:null,
to:null,t:0,on_stop:null,on_remove:null,visible:false});m=k.extend({init:function(a){this.draw=l(a)=="function"?a:a.code},parent:function(){}});m.rotate=function(a){return function(){var b=a.rotation();a.rotation(b<6.1?b+0.1:0)}};m.remove=function(){this.parent().remove_child(this)};var i=function(a){return function(b){return new a(b)}};e.Animate=z;e.Draw=o;e.Util=H;e.Collision=t;e.Action=m;e.Clip=n;e.DisplayObject=j;e.Dot=A;e.Emitter=B;e.Image=p;e.Range=D;e.Rect=u;e.Shape=v;e.Sprite=q;e.Spritesheet=
E;e.Text=F;e.Tween=G;e.Physics=C;e.action=i(m);e.clip=i(n);e.dot=i(A);e.emitter=i(B);e.image=i(p);e.range=function(a,b){return new D(a,b)};e.rect=i(u);e.sprite=i(q);e.spritesheet=i(E);e.text=i(F);e.tween=i(G);e.physics=i(C)})(this,document);
