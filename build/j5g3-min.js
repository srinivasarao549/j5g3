(function(k,l,d){var o="0.1";var m=function(){var r={version:o},q=this,s=function(){return q._p.canvas.getContext("2d")},t=function(){var u=s();q.background.draw(u);q.root.draw(u)},p=function(u){g.Property.define(m,{canvas:null,fps:100,backgroundStyle:"black",width:640,height:480});g.Property.extend(q,u);if(q._p.canvas===null){q._p.canvas=l.getElementById("screen")}q.background=new j5g3.Rect({fillStyle:q.backgroundStyle(),width:q.width(),height:q.height()});q.root=new j5g3.Clip({width:q.width(),height:q.height()});q._p.canvas.width=q.width();q._p.canvas.height=q.height();q._p.canvas.addEventListener("click",q.onClick,false);u.start(g,l)};this._p={};this.run=function(){setInterval(t,this._p.fps)};this.start=function(u){if(typeof(u)=="function"){p({start:u})}else{p(u)}};this.invalidate=function(){}};var g=k.j5g3=new m();var j=function(p){return function(q){if(q!==d){this._p[p]=q;return this.invalidate()}return this._p[p]}};j.get=function(r,q){return function(p){return r[q]}};j.define=function(r,q){for(var p in q){r.prototype[p]=g.Property(p)}r.properties=q;return r};j.extend=function(t,s){t._p=n.clone(s);var r=t.constructor.properties,q;if(s){for(q in r){t._p[q]=s[q]||r[q]}}else{for(q in r){t._p[q]=r[q]}}};g.Property=j;var n={extend:function(q,p){for(var r in p){q[r]=p[r]}return q},clone:function(q){var p={};for(var r in q){p[r]=q[r]}return p},inherits:function(s,p,r,q){p.prototype=new s;j.define(p,r);n.extend(p.prototype,q);return p},Class:function(p,s,r,q){p.prototype=new s;j.define(p,r);n.extend(p.prototype,q);return p},getType:function(q){var p=typeof(q);if(p=="object"){if(q instanceof Array){p="array"}else{if(q instanceof e){p="j5g3"}}}return p}};g.Util=n;var c=g.Draw={Image:function(p){p.drawImage(this._p.source,0,0)},Sprite:function(q){var s=this.source(),p=this.width(),r=this.height();q.drawImage(s.image,s.x,s.y,s.w,s.h,0,0,p?p:s.w,r?r:s.h)},Container:function(q){var r=this.frame();for(var p in r){r[p].draw(q)}}};var e=function(p){g.Property.extend(this,p);this._dirty=true};n.extend(e.prototype,{begin:function(p){p.save();p.globalAlpha*=this.alpha();p.translate(this.x(),this.y());p.scale(this.scaleX(),this.scaleY());p.rotate(this.rotation())},end:function(p){p.restore()},draw:function(p){this.begin(p);this.paint(p);this.end(p)},invalidate:function(){this._dirty=true},isDirty:function(){return this._dirty},align:function(q,p){switch(q){case"center":this.x(p.width()/2);break;case"left":this.x(0);break;case"right":this.x(p.width()-this.width());break;case"middle":this.y(p.height()/2);break}return this},collidesWith:function(t){var r=this.x()-t.x();var q=this.y()-t.y();var p=this.width();if(Math.abs(r)>p||Math.abs(q)>p){return false}var s=r*r+q*q;if(s>p*p){return false}return true},pos:function(p,q){this._p.x=p;this._p.y=q;this.invalidate();return this}});g.DisplayObject=g.Property.define(e,{source:null,parent:null,x:0,y:0,width:null,height:null,rotation:0,scaleX:1,scaleY:1,alpha:1});var h=function(p){g.Property.extend(this,p);if(!this._p.frames){this._p.frames=[[]]}this._frame=0;this._playing=true};g.Clip=n.Class(h,e,{frames:null},{frame:function(){f=this.frames()[this._frame];if(this._playing){this.nextFrame()}return f},totalFrames:function(){return this.frames().length},currentFrame:function(){return _frame},nextFrame:function(){this._frame=(this._frame<this.totalFrames()-1)?this._frame+1:0},paint:c.Container,stop:function(){this._playing=false},play:function(){this._playing=true},add:function(q){switch(j5g3.Util.getType(q)){case"function":q=new j5g3.Action(q);break;case"string":q=new j5g3.Image({source:q});break;case"object":q=new j5g3.Image(q);break;case"array":for(var p in q){this.add(q[p])}return this}q.parent(this);this.frames()[this._frame].push(q);return this},gotoFrame:function(p){this._frame=p;return this},gotoAndPlay:function(p){this.gotoFrame(p);this.play();return this},gotoAndStop:function(p){this.gotoFrame(p);this.stop();return this},alignChildren:function(r){var q=this.frame();for(var p in q){if(q[p].align){q[p].align(r,this)}}return this},animateTo:function(s,r,u){var t={};if(u===d){u=j5g3.Animate.Easing.None}for(var q in s){t[q]=s}return function(){u(t,s,this._iframe)}}});var b=function(p){if(typeof p=="string"){p={source:p}}g.Property.extend(this,p);if(this._p.source){this.source(this._p.source)}};b.prototype=new e();g.Util.extend(b.prototype,{paint:g.Draw.Image,source:function(p){if(p){if(typeof(p)=="string"){this._p.source=new k.Image;this._p.source.src=p}else{this._p.source=p}if(this._p.width===null){this._p.width=this._p.source.width}if(this._p.height===null){this._p.height=this._p.source.height}this.invalidate();return this}return this._p.source}});g.Image=b;var a=function(p){j.extend(this,p)};g.Rect=n.inherits(e,a,{fillStyle:null});a.prototype.paint=function(p){if(this._p.fillStyle){p.fillStyle=this._p.fillStyle}p.fillRect(this._p.x,this._p.y,this._p.width,this._p.height)};j5g3.Sprite=function(p){j5g3.DisplayObject.apply(this,[p]);this.paint=j5g3.Engine.algorithms.drawSprite};j5g3.Spritesheet=function(p){if(typeof p=="string"){p={source:new j5g3.Image(p)}}if(typeof p.source=="string"){p.source=new j5g3.Image(p.source)}if(p.width===d&&p.source){p.width=p.source.width()}if(p.height===d&&p.source){p.height=p.source.height()}this._p=j5g3.extend({cols:1,rows:1,type:"grid"},p);j5g3.properties(this,["width","height","source","sprites"]);this.clip=function(){var q=this.sprites(),r=[];for(i=0;i<arguments.length;i++){r.push([q[arguments[i]]])}return new j5g3.Clip({frames:r})};this.grid=function(q,B){var v=[],t=this.width()/q,u=this.height()/B;for(var z=0;z<q;z++){for(var A=0;A<q;A++){v.push(new j5g3.Sprite({source:{image:this.source().source(),x:A*t,y:z*u,w:t,h:u}}))}}this._p.sprites=v;return this}};j5g3.Text=function(p){if(typeof p=="string"){p={text:p}}p=j5g3.extend({fillStyle:"white"},p);j5g3.DisplayObject.apply(this,[p]);j5g3.properties(this,["text","fillStyle","font"]);this._applyContext=function(q){if(this._p.fillStyle){q.fillStyle=this._p.fillStyle}if(this._p.font){q.font=this._p.font}};this.paint=function(q){this._applyContext(q);q.fillText(this.text(),0,0)};this.width=function(){var q=j5g3.Engine.canvas().getContext("2d");this._applyContext(q);var r=q.measureText(this.text());return r.width}};g.Action=function(p){this.draw=(typeof p=="function")?p:p.code;this.parent=function(){}};g.Action.rotate=function(p){return function(){var q=p.rotation();p.rotation(q<6.1?q+0.1:0)}}})(this,document);