(function(j,k,c){var m="0.1";var l=function(){var p={version:m},o=this,q=function(){return o._p.canvas.getContext("2d")},r=function(){var s=q();o.background.draw(s);o.root.draw(s)},n=function(s){d.Property.extend(o,s);d.Property.define(l);if(o._p.canvas===null){o._p.canvas=k.getElementById("screen")}o.background=new j5g3.Rect({fillStyle:o.backgroundStyle(),width:o.width(),height:o.height()});o.root=new j5g3.Clip({width:o.width(),height:o.height()});o._p.canvas.width=o.width();o._p.canvas.height=o.height();o._p.canvas.addEventListener("click",o.onClick,false);s.start(d,k)};this._p={};this.run=function(){setInterval(r,this._p.fps)};this.start=function(s){if(typeof(s)=="function"){n({start:s})}else{n(s)}};this.invalidate=function(){}};l.properties={canvas:null,fps:100,backgroundStyle:"black",width:640,height:480};var d=j.j5g3=new l();var h=function(n){return function(o){if(o!==c){this._p[n]=o;return this.invalidate()}return this._p[n]}};h.get=function(o,n){return function(p){return o[n]}};h.define=function(o){for(var n in o.properties){o.prototype[n]=d.Property(n)}};h.extend=function(r,q){var o=r.constructor.properties,n;for(n in o){r._p[n]=q[n]||o[n]}};d.Property=h;d.Util={extend:function(o,n){for(var p in n){o[p]=n[p]}return o},inherits:function(p,n,o){n.apply(p,o)},getType:function(o){var n=typeof(o);if(n=="object"){if(o instanceof Array){n="array"}else{if(o instanceof e){n="j5g3"}}}return n}};d.Draw={Image:function(n){n.drawImage(this.source(),0,0)},Sprite:function(o){var q=this.source(),n=this.width(),p=this.height();o.drawImage(q.image,q.x,q.y,q.w,q.h,0,0,n?n:q.w,p?p:q.h)},Container:function(o){var p=this.frame();for(var n in p){p[n].draw(o)}}};var e=function(n){this._p={};d.Property.extend(this,n);this._dirty=true};e.prototype={begin:function(n){n.save();n.globalAlpha*=this.alpha();n.translate(this.x(),this.y());n.scale(this.scaleX(),this.scaleY());n.rotate(this.rotation())},end:function(n){n.restore()},draw:function(n){this.begin(n);this.paint(n);this.end(n)},invalidate:function(){this._dirty=true},isDirty:function(){return this._dirty},align:function(o,n){switch(o){case"center":this.x(n.width()/2);break;case"left":this.x(0);break;case"right":this.x(n.width()-this.width());break;case"middle":this.y(n.height()/2);break}return this},collidesWith:function(r){var p=this.x()-r.x();var o=this.y()-r.y();var n=this.width();if(Math.abs(p)>n||Math.abs(o)>n){return false}var q=p*p+o*o;if(q>n*n){return false}return true},pos:function(n,o){this._p.x=n;this._p.y=o;this.invalidate();return this}};e.properties={source:null,parent:null,x:0,y:0,width:null,height:null,rotation:0,scaleX:1,scaleY:1,alpha:1};e.readonly={};d.Property.define(e);d.DisplayObject=e;var g=function(n){d.Property.extend(this,n);if(!this._p.frames){this._p.frames=[[]]}this._frame=0;this._playing=true};g.prototype=new e;g.properties={frames:null};d.Property.define(g);d.Util.extend(g.prototype,{frame:function(){f=this.frames()[this._frame];if(this._playing){this.nextFrame()}return f},totalFrames:function(){return this.frames().length},currentFrame:function(){return _frame},nextFrame:function(){this._frame=(this._frame<this.totalFrames()-1)?this._frame+1:0},paint:d.Draw.Container,stop:function(){this._playing=false},play:function(){this._playing=true},add:function(o){switch(j5g3.Util.getType(o)){case"function":o=new j5g3.Action(o);break;case"string":o=new j5g3.Image({source:o});break;case"object":o=new j5g3.Image(o);break;case"array":for(var n in o){this.add(o[n])}return this}o.parent(this);this.frames()[this._frame].push(o);return this},gotoFrame:function(n){this._frame=n;return this},gotoAndPlay:function(n){this.gotoFrame(n);this.play();return this},gotoAndStop:function(n){this.gotoFrame(n);this.stop();return this},alignChildren:function(p){var o=this.frame();for(var n in o){if(o[n].align){o[n].align(p,this)}}return this},animateTo:function(q,o,s){var r={};if(s===c){s=j5g3.Animate.Easing.None}for(var n in q){r[n]=q}return function(){s(r,q,this._iframe)}}});d.Clip=g;var b=function(n){if(typeof n=="string"){n={source:n}}d.Property.extend(this,n);if(this._p.source){this.source(this._p.source)}};b.prototype=new e();d.Util.extend(b.prototype,{paint:d.Draw.Image,source:function(n){if(n){if(typeof(n)=="string"){this._p.source=new j.Image;this._p.source.src=n}else{this._p.source=n}if(this._p.width===null){this._p.width=this._p.source.width}if(this._p.height===null){this._p.height=this._p.source.height}this.invalidate();return this}return this._p.source}});d.Image=b;var a=function(n){h.extend(this,n);this.fillStyle=function(o){return o?(this.invalidate(),(this._p.fillStyle=o),this):this._p.fillStyle};this.paint=function(o){if(this._p.fillStyle){o.fillStyle=this._p.fillStyle}o.fillRect(this._p.x,this._p.y,this._p.width,this._p.height)}};a.prototype=new e;d.Rect=a;j5g3.Sprite=function(n){j5g3.DisplayObject.apply(this,[n]);this.paint=j5g3.Engine.algorithms.drawSprite};j5g3.Spritesheet=function(n){if(typeof n=="string"){n={source:new j5g3.Image(n)}}if(typeof n.source=="string"){n.source=new j5g3.Image(n.source)}if(n.width===c&&n.source){n.width=n.source.width()}if(n.height===c&&n.source){n.height=n.source.height()}this._p=j5g3.extend({cols:1,rows:1,type:"grid"},n);j5g3.properties(this,["width","height","source","sprites"]);this.clip=function(){var o=this.sprites(),p=[];for(i=0;i<arguments.length;i++){p.push([o[arguments[i]]])}return new j5g3.Clip({frames:p})};this.grid=function(o,z){var t=[],p=this.width()/o,q=this.height()/z;for(var u=0;u<o;u++){for(var v=0;v<o;v++){t.push(new j5g3.Sprite({source:{image:this.source().source(),x:v*p,y:u*q,w:p,h:q}}))}}this._p.sprites=t;return this}};j5g3.Text=function(n){if(typeof n=="string"){n={text:n}}n=j5g3.extend({fillStyle:"white"},n);j5g3.DisplayObject.apply(this,[n]);j5g3.properties(this,["text","fillStyle","font"]);this._applyContext=function(o){if(this._p.fillStyle){o.fillStyle=this._p.fillStyle}if(this._p.font){o.font=this._p.font}};this.paint=function(o){this._applyContext(o);o.fillText(this.text(),0,0)};this.width=function(){var o=j5g3.Engine.canvas().getContext("2d");this._applyContext(o);var p=o.measureText(this.text());return p.width}};d.Action=function(n){this.draw=(typeof n=="function")?n:n.code;this.parent=function(){}};d.Action.rotate=function(n){return function(){var o=n.rotation();n.rotation(o<6.1?o+0.1:0)}}})(this,document);