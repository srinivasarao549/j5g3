var j5g3={Easing:{RegularOut:function(){return 0}},Util:{extend:function(d,c){for(var e in c){d[e]=c[e]}return d},getType:function(b){var a=typeof(b);if(a=="object"){if(b instanceof Array){a="array"}}return a}},Engine:{canvas:null,root:null,algorithms:{drawImage:function(a){a.drawImage(this.source(),0,0)},drawSprite:function(b){var d=this.source();var a=this.width();var c=this.height();b.drawImage(d.image,d.x,d.y,d.w,d.h,0,0,a?a:d.w,c?c:d.h)},drawContainer:function(b){var c=this.frame();for(var a in c){c[a].draw(b)}}},onClick:function(){},initialize:function(a){if(a){this.canvas=a.canvas;this.fps=a.fps}if(!this.canvas){this.canvas=document.getElementById("screen")}this.canvas.width=640;this.canvas.height=480;if(!this.fps){this.fps=100}this.background=new j5g3.Rect({width:640,height:480});this.root=new j5g3.Clip({width:640,height:480});this.canvas.addEventListener("click",this.onClick,false);return this},getContext:function(){return this.canvas.getContext("2d")},gameLoop:function(){var a=this.getContext();this.background.draw(a);this.root.draw(a)},run:function(){setInterval("j5g3.Engine.gameLoop()",this.fps)}}};j5g3.DisplayObject=function(a){this._p=j5g3.Util.extend({x:0,y:0,width:null,height:null,rotation:0,scaleX:1,scaleY:1,alpha:1},a);this._dirty=false;this.begin=function(b){b.save();b.globalAlpha*=this._p.alpha;b.translate(this.x(),this.y());b.scale(this.scaleX(),this.scaleY());b.rotate(this.rotation())};this.end=function(b){b.restore()};this.draw=function(b){this.begin(b);this.paint(b);this.end(b)};this.source=function(){return this._p.source};this.invalidate=function(){this._dirty=true};this.isDirty=function(){return this._dirty};this.alpha=function(b){return b?(this.invalidate(),(this._p.alpha=b),this):this._p.alpha};this.width=function(b){return b?(this.invalidate(),(this._p.width=b),this):this._p.width};this.height=function(b){return b?(this.invalidate(),(this._p.height=b),this):this._p.height};this.x=function(b){return b?(this.invalidate(),(this._p.x=b),this):this._p.x};this.y=function(b){return b?(this.invalidate(),(this._p.y=b),this):this._p.y};this.scaleX=function(b){return b?(this.invalidate(),(this._p.scaleX=b),this):this._p.scaleX};this.scaleY=function(b){return b?(this.invalidate(),(this._p.scaleY=b),this):this._p.scaleY};this.rotation=function(b){return b?(this.invalidate(),(this._p.rotation=b),this):this._p.rotation};this.align=function(c,b){switch(c){case"center":this.x(b.width()/2);break;case"left":this.x(0);break;case"right":this.x(b.width()-this.width());break;case"middle":this.y(b.height()/2);break}};this.collidesWith=function(g){var d=this.x()-g.x();var c=this.y()-g.y();var b=this.width();if(Math.abs(d)>b||Math.abs(c)>b){return false}var e=d*d+c*c;if(e>b*b){return false}return true}};j5g3.Rect=function(a){j5g3.DisplayObject.apply(this,[a]);this.fillStyle=function(b){return b?(this.invalidate(),(this._p.fillStyle=b),this):this._p.fillStyle};this.paint=function(b){if(this._p.fillStyle){b.fillStyle=this._p.fillStyle}b.fillRect(this._p.x,this._p.y,this._p.width,this._p.height)}};j5g3.Image=function(a){j5g3.DisplayObject.apply(this,[a]);if(typeof(this._p.source)=="string"){this._p.source=new Image;this._p.source.src=a.source}if(this._p.width===null){this._p.width=this._p.source.width}if(this._p.height===null){this._p.height=this._p.source.height}this.paint=j5g3.Engine.algorithms.drawImage};j5g3.Sprite=function(a){j5g3.DisplayObject.apply(this,[a]);this.paint=j5g3.Engine.algorithms.drawSprite};j5g3.Clip=function(a){j5g3.DisplayObject.apply(this,[a]);if(!this._p.frames){this._p.frames=[[]]}this._frame=0;this._playing=true;this.frames=function(b){return b?(this.invalidate(),(this._p.frames=b),this):this._p.frames};this.frame=function(){f=this.frames()[this._frame];if(this._playing){this.nextFrame()}return f};this.totalFrames=function(){return this.frames().length};this.currentFrame=function(){return _frame};this.nextFrame=function(){this._frame=(this._frame<this.totalFrames()-1)?this._frame+1:0};this.paint=j5g3.Engine.algorithms.drawContainer;this.stop=function(){this._playing=false};this.play=function(){this._playing=true};this.add=function(c){switch(j5g3.Util.getType(c)){case"function":c=new j5g3.Action({code:c});break;case"string":c=new j5g3.Image({source:c});break;case"array":for(var b in c){this.add(c[b])}return this}this.frames()[this._frame].push(c);return this};this.gotoFrame=function(b){this._frame=b;return this};this.gotoAndPlay=function(b){this.gotoFrame(b);this.play();return this};this.gotoAndStop=function(b){this.gotoFrame(b);this.stop();return this};this.alignChildren=function(d){var c=this.frame();for(var b in c){if(c[b].align){c[b].align(d,this)}}return this};this.animateTo=function(h,e,k,c){var b=this.frames();for(var g=1;g<k;g++){b[g]=b[g-1];for(var d in b[g-1]){b[g][d][h]=c.apply(b[0][d][h],e,g)}}}};j5g3.Text=function(a){j5g3.DisplayObject.apply(this,[a]);this.text=function(){return this._p.text};this.paint=function(b){if(this._p.fillStyle){b.fillStyle=this._p.fillStyle}b.fillText(this.text(),0,0)}};j5g3.Action=function(a){this.draw=a.code};