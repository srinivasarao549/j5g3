(function(m,p,j){var v="0.1",d,w,a,u,A,q,y,l,x,k,o,z,t,h,b,g,n,e=m.j5g3=new (function(){var D={version:v},C=this,E=function(){return b.getContext("2d")},B=function(F){e.Property.define(C.constructor,{canvas:null,backgroundStyle:"black",width:640,height:480});g(C,F);if(C._p.canvas===null){C._p.canvas=e.id("screen")}b=C._p.canvas;C.background=new k({fillStyle:C.backgroundStyle(),width:C.width(),height:C.height()});C.root=new a({width:C.width(),height:C.height()});b.width=C.width();b.height=C.height();b.addEventListener("click",C.onClick,false);F.start(e,p)};this.run=function(){setInterval(this.gameLoop,this._p.fps)};this.gameLoop=function(){var F=E();C.background.draw(F);C.root.draw(F)};this.fps=function(F){if(F===j){return 1000/this._p.fps}this._p.fps=1000/F;return this};this.start=function(F){B(typeof(F)=="function"?{start:F}:F)};this.invalidate=function(){return this};this.id=function(F){return p.getElementById(F)}});w={Easing:{None:function(){},RegularOut:function(){return 0}}};l=function(B){return function(C){return C===j?this._p[B]:(this._p[B]=C,this.invalidate())}};l.get=function(C,B){return function(D){return C[B]}};l.define=function(D,C){for(var B in C){D.prototype[B]=l(B)}D.properties=C;return D};g=l.extend=function(E,D){E._p={};var C=E.constructor.properties,B;if(D){for(B in C){E._p[B]=D[B]||C[B]}}else{for(B in C){E._p[B]=C[B]}}return E._p};h={extend:function(C,B){for(var D in B){C[D]=B[D]}return C},inherit:function(C,B){for(var D in B){C[D]=C[D]||B[D]}return C},clone:function(C){var B={};for(var D in C){B[D]=C[D]}return B},Class:function(B,E,D,C){h.extend(B.prototype,new E);l.define(B,D);h.inherit(D,E.properties);h.extend(B.prototype,C);return B}};u=h.Class;n=h.getType=function(C){var B=typeof(C);if(B=="object"){if(C instanceof Array){return"array"}if(C instanceof HTMLElement){return"DOM"}if(C._p){return"j5g3"}}return B};q={Image:function(B){B.drawImage(this._p.source,0,0)},Sprite:function(C){var E=this.source(),B=this.width(),D=this.height();C.drawImage(E.image,E.x,E.y,E.w,E.h,0,0,B?B:E.w,D?D:E.h)},Container:function(C){var D=this.frame();for(var B in D){D[B].draw(C)}},Text:function(B){B.fillText(this.text(),0,0)}};u(A=function(B){this._p={};g(this,B);this._dirty=true},Object,{source:null,parent:null,x:0,y:0,width:null,height:null,rotation:0,scaleX:1,scaleY:1,alpha:1},{begin:function(B){B.save();B.globalAlpha*=this.alpha();B.translate(this.x(),this.y());B.scale(this.scaleX(),this.scaleY());B.rotate(this.rotation())},end:function(B){B.restore()},draw:function(B){this.begin(B);this.paint(B);this.end(B)},invalidate:function(){this._dirty=true;return this},isDirty:function(){return this._dirty},align:function(C,B){switch(C){case"center":this.x(B.width()/2);break;case"left":this.x(0);break;case"right":this.x(B.width()-this.width());break;case"middle":this.y(B.height()/2);break}return this},collidesWith:function(F){var D=this.x()-F.x();var C=this.y()-F.y();var B=this.width();if(Math.abs(D)>B||Math.abs(C)>B){return false}var E=D*D+C*C;if(E>B*B){return false}return true},pos:function(B,C){this._p.x=B;this._p.y=C;this.invalidate();return this}});u(a=function(B){g(this,B);if(!this._p.frames){this._p.frames=[[]]}this._frame=0;this._playing=true},A,{frames:null},{frame:function(){f=this.frames()[this._frame];if(this._playing){this.nextFrame()}return f},totalFrames:function(){return this.frames().length},currentFrame:function(){return _frame},nextFrame:function(){this._frame=(this._frame<this.totalFrames()-1)?this._frame+1:0},paint:q.Container,stop:function(){this._playing=false},play:function(){this._playing=true},add:function(C){switch(n(C)){case"function":C=new d(C);break;case"string":C=new y({source:C});break;case"object":C=new y(C);break;case"array":for(var B in C){this.add(C[B])}return this}C.parent(this);var D=this.frames();D[D.length-1].push(C);return this},gotoFrame:function(B){this._frame=B;return this},gotoAndPlay:function(B){this.gotoFrame(B);this.play();return this},gotoAndStop:function(B){this.gotoFrame(B);this.stop();return this},alignChildren:function(D){var C=this.frame();for(var B in C){if(C[B].align){C[B].align(D,this)}}return this},animateTo:function(D,C,F){var E={};if(F===j){F=w.Easing.None}for(var B in D){E[B]=D}return function(){F(E,D,this._iframe)}}});u(y=function(B){switch(n(B)){case"string":case"DOM":B={source:B};break}g(this,B);if(this._p.source){this.source(this._p.source)}},A,{},{paint:q.Image,source:function(B){if(B){if(typeof(B)=="string"){this._p.source=new m.Image;this._p.source.src=B}else{this._p.source=B}if(this._p.width===null){this._p.width=this._p.source.width}if(this._p.height===null){this._p.height=this._p.source.height}this.invalidate();return this}return this._p.source}});u(x=function(C,B){if(typeof C!="object"){C={start:C,end:B}}g(this,C)},Object,{start:0,end:0},{to_a:function(){var D=this._p,C=D.start,B=[];for(;C<D.end;C++){B.push(C)}return B}});u(k=function(B){g(this,B)},A,{fillStyle:null},{paint:function(B){if(this._p.fillStyle){B.fillStyle=this._p.fillStyle}B.fillRect(this._p.x,this._p.y,this._p.width,this._p.height)}});u(o=function(B){g(this,B)},A,{},{paint:q.Sprite});u(z=function(B){switch(n(B)){case"string":case"DOM":case"j5g3":B={source:B}}switch(n(B.source)){case"string":case"DOM":B.source=new y(B.source);break}if(B.width===j&&B.source){B.width=B.source.width()}if(B.height===j&&B.source){B.height=B.source.height()}var C=g(this,B);C.sprites=C.sprites||[]},Object,{width:0,height:0,source:null,sprites:j,cols:1,rows:1,type:"grid"},{clip:function(B){return this.clipArray(arguments)},clip_array:function(D){var B=this.sprites(),C=[];for(i=0;i<D.length;i++){C.push([B[D[i]]])}return new a({frames:C})},clip_range:function(B){return this.clipArray(B.to_a())},cut:function(C){var B=new o(n(C)=="array"?{source:{image:this.source().source(),x:C[0],y:C[1],w:C[2],h:C[3]}}:{source:{image:this.source().source(),x:C.x,y:C.y,w:C.w,h:C.h}});this._p.sprites.push(B);return B},grid:function(B,F){var E=this._p.sprites=[],C=this.width()/B,D=this.height()/F;r=0,c=0;for(;r<B;r++){for(;c<B;c++){E.push(new o({source:{image:this.source().source(),x:c*C,y:r*D,w:C,h:D}}))}}return this}});var s;u(t=function(B){if(typeof B=="string"){B={text:B}}g(this,B)},A,{text:"",fillStyle:"white",font:null},{begin:function(B){s.apply(this,[B]);if(this._p.fillStyle){B.fillStyle=this._p.fillStyle}if(this._p.font){B.font=this._p.font}},paint:q.Text,width:function(){var B=b.getContext("2d");this.begin(B);var C=B.measureText(this.text());return C.width}});s=A.prototype.begin;d=function(B){this.draw=(typeof B=="function")?B:B.code;this.parent=function(){}};d.rotate=function(B){return function(){var C=B.rotation();B.rotation(C<6.1?C+0.1:0)}};e.Action=d;e.Animate=w;e.Clip=a;e.DisplayObject=A;e.Draw=q;e.Image=y;e.Property=l;e.Range=x;e.Rect=k;e.Sprite=o;e.Spritesheet=z;e.Text=t;e.Util=h})(this,document);