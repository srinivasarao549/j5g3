(function(m,p,j){var v="0.1",d,w,a,u,B,q,z,l,x,k,o,A,t,h,b,g,n,e=m.j5g3=new (function(){var D={version:v},C=this,E=function(){return b.getContext("2d")},f=function(F){e.Property.define(C.constructor,{canvas:null,backgroundStyle:"black",width:640,height:480});g(C,F);if(C._p.canvas===null){C._p.canvas=e.id("screen")}b=C._p.canvas;C.background=new k({fillStyle:C.backgroundStyle(),width:C.width(),height:C.height()});C.root=new a({width:C.width(),height:C.height()});b.width=C.width();b.height=C.height();b.addEventListener("click",C.onClick,false);F.start(e,p)};this.run=function(){setInterval(this.gameLoop,this._p.fps)};this.gameLoop=function(){var F=E();C.background.draw(F);C.root.draw(F)};this.fps=function(F){if(F===j){return 1000/this._p.fps}this._p.fps=1000/F;return this};this.start=function(F){f(typeof(F)=="function"?{start:F}:F)};this.invalidate=function(){return this};this.id=function(F){return p.getElementById(F)}});w={Easing:{None:function(){},RegularOut:function(){return 0}}};l=function(f){return function(C){return C===j?this._p[f]:(this._p[f]=C,this.invalidate())}};l.get=function(C,f){return function(D){return C[f]}};l.define=function(D,C){for(var f in C){D.prototype[f]=l(f)}D.properties=C;return D};g=l.extend=function(E,D){E._p={};var C=E.constructor.properties,f;if(D){for(f in C){E._p[f]=D[f]||C[f]}}else{for(f in C){E._p[f]=C[f]}}return E._p};h={extend:function(C,f){for(var D in f){C[D]=f[D]}return C},inherit:function(C,f){for(var D in f){C[D]=C[D]||f[D]}return C},clone:function(C){var f={};for(var D in C){f[D]=C[D]}return f},Class:function(f,E,D,C){h.extend(f.prototype,new E);l.define(f,D);h.inherit(D,E.properties);h.extend(f.prototype,C);return f}};u=h.Class;n=h.getType=function(C){var f=typeof(C);if(f=="object"){if(C instanceof Array){return"array"}if(C instanceof HTMLElement){return"DOM"}if(C._p){return"j5g3"}}return f};q={Image:function(f){f.drawImage(this._p.source,0,0)},Sprite:function(C){var E=this.source(),f=this.width(),D=this.height();C.drawImage(E.image,E.x,E.y,E.w,E.h,0,0,f?f:E.w,D?D:E.h)},Container:function(C){var D=this.frame();for(var f in D){D[f].draw(C)}},Text:function(f){f.fillText(this.text(),0,0)}};u(B=function(f){this._p={};g(this,f);this._dirty=true},Object,{source:null,parent:null,x:0,y:0,width:null,height:null,rotation:0,scaleX:1,scaleY:1,alpha:1},{begin:function(f){f.save();f.globalAlpha*=this.alpha();f.translate(this.x(),this.y());f.scale(this.scaleX(),this.scaleY());f.rotate(this.rotation())},end:function(f){f.restore()},draw:function(f){this.begin(f);this.paint(f);this.end(f)},invalidate:function(){this._dirty=true;return this},isDirty:function(){return this._dirty},align:function(C,f){switch(C){case"center":this.x(f.width()/2);break;case"left":this.x(0);break;case"right":this.x(f.width()-this.width());break;case"middle":this.y(f.height()/2);break}return this},collidesWith:function(F){var D=this.x()-F.x();var C=this.y()-F.y();var f=this.width();if(Math.abs(D)>f||Math.abs(C)>f){return false}var E=D*D+C*C;if(E>f*f){return false}return true},pos:function(f,C){this._p.x=f;this._p.y=C;this.invalidate();return this}});u(a=function(f){g(this,f);if(!this._p.frames){this._p.frames=[[]]}this._frame=0;this._playing=true},B,{frames:null},{frame:function(){y=this.frames()[this._frame];if(this._playing){this.nextFrame()}return y},totalFrames:function(){return this.frames().length},currentFrame:function(){return _frame},nextFrame:function(){this._frame=(this._frame<this.totalFrames()-1)?this._frame+1:0},paint:q.Container,stop:function(){this._playing=false},play:function(){this._playing=true},add:function(D){switch(n(D)){case"function":D=new d(D);break;case"string":D=new z({source:D});break;case"object":D=new z(D);break;case"array":for(var C in D){this.add(D[C])}return this}D.parent(this);var E=this.frames();E[E.length-1].push(D);return this},gotoFrame:function(f){this._frame=f;return this},gotoAndPlay:function(f){this.gotoFrame(f);this.play();return this},gotoAndStop:function(f){this.gotoFrame(f);this.stop();return this},alignChildren:function(D){var C=this.frame();for(var f in C){if(C[f].align){C[f].align(D,this)}}return this},animateTo:function(D,C,F){var E={};if(F===j){F=w.Easing.None}for(var f in D){E[f]=D}return function(){F(E,D,this._iframe)}}});u(z=function(f){switch(n(f)){case"string":case"DOM":f={source:f};break}g(this,f);if(this._p.source){this.source(this._p.source)}},B,{},{paint:q.Image,source:function(f){if(f){if(typeof(f)=="string"){this._p.source=new m.Image;this._p.source.src=f}else{this._p.source=f}if(this._p.width===null){this._p.width=this._p.source.width}if(this._p.height===null){this._p.height=this._p.source.height}this.invalidate();return this}return this._p.source}});u(x=function(C,f){if(typeof C!="object"){C={start:C,end:f}}g(this,C)},Object,{start:0,end:0},{to_a:function(){var D=this._p,C=D.start,f=[];for(;C<D.end;C++){f.push(C)}return f}});u(k=function(f){g(this,f)},B,{fillStyle:null},{paint:function(f){if(this._p.fillStyle){f.fillStyle=this._p.fillStyle}f.fillRect(this._p.x,this._p.y,this._p.width,this._p.height)}});u(o=function(f){g(this,f)},B,{},{paint:q.Sprite});u(A=function(f){switch(n(f)){case"string":case"DOM":case"j5g3":f={source:f}}switch(n(f.source)){case"string":case"DOM":f.source=new z(f.source);break}if(f.width===j&&f.source){f.width=f.source.width()}if(f.height===j&&f.source){f.height=f.source.height()}var C=g(this,f);C.sprites=C.sprites||[]},Object,{width:0,height:0,source:null,sprites:j,cols:1,rows:1,type:"grid"},{clip:function(f){return this.clipArray(arguments)},clip_array:function(D){var f=this.sprites(),C=[];for(i=0;i<D.length;i++){C.push([f[D[i]]])}return new a({frames:C})},clip_range:function(f){return this.clipArray(f.to_a())},cut:function(C){var f=new o(n(C)=="array"?{source:{image:this.source().source(),x:C[0],y:C[1],w:C[2],h:C[3]}}:{source:{image:this.source().source(),x:C.x,y:C.y,w:C.w,h:C.h}});this._p.sprites.push(f);return f},grid:function(f,F){var E=this._p.sprites=[],C=this.width()/f,D=this.height()/F;r=0,c=0;for(;r<f;r++){for(;c<f;c++){E.push(new o({source:{image:this.source().source(),x:c*C,y:r*D,w:C,h:D}}))}}return this}});var s;u(t=function(f){if(typeof f=="string"){f={text:f}}g(this,f)},B,{text:"",fillStyle:"white",font:null},{begin:function(f){s.apply(this,[f]);if(this._p.fillStyle){f.fillStyle=this._p.fillStyle}if(this._p.font){f.font=this._p.font}},paint:q.Text,width:function(){var f=b.getContext("2d");this.begin(f);var C=f.measureText(this.text());return C.width}});s=B.prototype.begin;d=function(f){this.draw=(typeof f=="function")?f:f.code;this.parent=function(){}};d.rotate=function(f){return function(){var C=f.rotation();f.rotation(C<6.1?C+0.1:0)}};var y=function(f){return function(C){return new f(C)}};e.Animate=w;e.Draw=q;e.Property=l;e.Util=h;e.Action=d;e.Clip=a;e.DisplayObject=B;e.Image=z;e.Range=x;e.Rect=k;e.Sprite=o;e.Spritesheet=A;e.Text=t;e.action=y(d);e.clip=y(a);e.image=y(z);e.range=y(x);e.rect=y(k);e.sprite=y(o);e.spritesheet=y(A);e.text=y(t)})(this,document);