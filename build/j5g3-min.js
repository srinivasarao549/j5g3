(function(l,n,h){var s="0.1",c,t,a,r,x,o,v,k,u,j,m,w,q,g,b,e,d=l.j5g3=new (function(){var A={version:s},z=this,B=function(){return b.getContext("2d")},y=function(C){d.Property.define(z.constructor,{canvas:null,fps:100,backgroundStyle:"black",width:640,height:480});e(z,C);if(z._p.canvas===null){z._p.canvas=n.getElementById("screen")}b=z._p.canvas;z.background=new j({fillStyle:z.backgroundStyle(),width:z.width(),height:z.height()});z.root=new a({width:z.width(),height:z.height()});b.width=z.width();b.height=z.height();b.addEventListener("click",z.onClick,false);C.start(d,n)};this._p={};this.run=function(){setInterval(this.gameLoop,this._p.fps)};this.gameLoop=function(){var C=B();z.background.draw(C);z.root.draw(C)};this.start=function(C){y(typeof(C)=="function"?{start:C}:C)};this.invalidate=function(){return this};this.id=function(C){return n.getElementById(C)}});t={Easing:{None:function(){},RegularOut:function(){return 0}}};k=function(y){return function(z){if(z!==h){this._p[y]=z;return this.invalidate()}return this._p[y]}};k.get=function(z,y){return function(A){return z[y]}};k.define=function(A,z){for(var y in z){A.prototype[y]=k(y)}A.properties=z;return A};e=k.extend=function(B,A){B._p={};var z=B.constructor.properties,y;if(A){for(y in z){B._p[y]=A[y]||z[y]}}else{for(y in z){B._p[y]=z[y]}}};g={extend:function(z,y){for(var A in y){z[A]=y[A]}return z},inherit:function(z,y){for(var A in y){z[A]=z[A]||y[A]}return z},clone:function(z){var y={};for(var A in z){y[A]=z[A]}return y},Class:function(y,B,A,z){g.extend(y.prototype,new B);k.define(y,A);g.inherit(A,B.properties);g.extend(y.prototype,z);return y},getType:function(z){var y=typeof(z);if(y=="object"){if(z instanceof Array){return"array"}if(z instanceof HTMLElement){return"DOM"}if(z._p){return"j5g3"}}return y}};r=g.Class;o={Image:function(y){y.drawImage(this._p.source,0,0)},Sprite:function(z){var B=this.source(),y=this.width(),A=this.height();z.drawImage(B.image,B.x,B.y,B.w,B.h,0,0,y?y:B.w,A?A:B.h)},Container:function(z){var A=this.frame();for(var y in A){A[y].draw(z)}},Text:function(y){y.fillText(this.text(),0,0)}};r(x=function(y){this._p={};e(this,y);this._dirty=true},Object,{source:null,parent:null,x:0,y:0,width:null,height:null,rotation:0,scaleX:1,scaleY:1,alpha:1},{begin:function(y){y.save();y.globalAlpha*=this.alpha();y.translate(this.x(),this.y());y.scale(this.scaleX(),this.scaleY());y.rotate(this.rotation())},end:function(y){y.restore()},draw:function(y){this.begin(y);this.paint(y);this.end(y)},invalidate:function(){this._dirty=true;return this},isDirty:function(){return this._dirty},align:function(z,y){switch(z){case"center":this.x(y.width()/2);break;case"left":this.x(0);break;case"right":this.x(y.width()-this.width());break;case"middle":this.y(y.height()/2);break}return this},collidesWith:function(C){var A=this.x()-C.x();var z=this.y()-C.y();var y=this.width();if(Math.abs(A)>y||Math.abs(z)>y){return false}var B=A*A+z*z;if(B>y*y){return false}return true},pos:function(z,A){this._p.x=z;this._p.y=A;this.invalidate();return this}});r(a=function(y){e(this,y);if(!this._p.frames){this._p.frames=[[]]}this._frame=0;this._playing=true},x,{frames:null},{frame:function(){f=this.frames()[this._frame];if(this._playing){this.nextFrame()}return f},totalFrames:function(){return this.frames().length},currentFrame:function(){return _frame},nextFrame:function(){this._frame=(this._frame<this.totalFrames()-1)?this._frame+1:0},paint:o.Container,stop:function(){this._playing=false},play:function(){this._playing=true},add:function(z){switch(g.getType(z)){case"function":z=new c(z);break;case"string":z=new v({source:z});break;case"object":z=new v(z);break;case"array":for(var y in z){this.add(z[y])}return this}z.parent(this);var A=this.frames();A[A.length-1].push(z);return this},gotoFrame:function(y){this._frame=y;return this},gotoAndPlay:function(y){this.gotoFrame(y);this.play();return this},gotoAndStop:function(y){this.gotoFrame(y);this.stop();return this},alignChildren:function(A){var z=this.frame();for(var y in z){if(z[y].align){z[y].align(A,this)}}return this},animateTo:function(A,z,C){var B={};if(C===h){C=t.Easing.None}for(var y in A){B[y]=A}return function(){C(B,A,this._iframe)}}});r(v=function(y){switch(g.getType(y)){case"string":case"DOM":y={source:y};break}e(this,y);if(this._p.source){this.source(this._p.source)}},x,{},{paint:o.Image,source:function(y){if(y){if(typeof(y)=="string"){this._p.source=new l.Image;this._p.source.src=y}else{this._p.source=y}if(this._p.width===null){this._p.width=this._p.source.width}if(this._p.height===null){this._p.height=this._p.source.height}this.invalidate();return this}return this._p.source}});r(u=function(z,y){if(typeof z!="object"){z={start:z,end:y}}e(this,z)},Object,{start:0,end:0},{to_a:function(){var A=this._p,z=A.start,y=[];for(;z<A.end;z++){y.push(z)}return y}});r(j=function(y){e(this,y)},x,{fillStyle:null},{paint:function(y){if(this._p.fillStyle){y.fillStyle=this._p.fillStyle}y.fillRect(this._p.x,this._p.y,this._p.width,this._p.height)}});r(m=function(y){e(this,y)},x,{},{paint:o.Sprite});r(w=function(y){switch(g.getType(y)){case"string":case"DOM":case"j5g3":y={source:y}}switch(g.getType(y.source)){case"string":case"DOM":y.source=new v(y.source);break}if(y.width===h&&y.source){y.width=y.source.width()}if(y.height===h&&y.source){y.height=y.source.height()}e(this,y)},Object,{width:0,height:0,source:null,sprites:0,cols:1,rows:1,type:"grid"},{clip:function(){return this.clipArray(arguments)},clipArray:function(A){var y=this.sprites(),z=[];for(i=0;i<A.length;i++){z.push([y[A[i]]])}return new a({frames:z})},clipRange:function(y){return this.clipArray(y.to_a())},grid:function(z,F){var C=[],A=this.width()/z,B=this.height()/F;for(var D=0;D<z;D++){for(var E=0;E<z;E++){C.push(new m({source:{image:this.source().source(),x:E*A,y:D*B,w:A,h:B}}))}}this._p.sprites=C;return this}});var p;r(q=function(y){if(typeof y=="string"){y={text:y}}e(this,y)},x,{text:"",fillStyle:"white",font:null},{begin:function(y){p.apply(this,[y]);if(this._p.fillStyle){y.fillStyle=this._p.fillStyle}if(this._p.font){y.font=this._p.font}},paint:o.Text,width:function(){var y=b.getContext("2d");this.begin(y);var z=y.measureText(this.text());return z.width}});p=x.prototype.begin;c=function(y){this.draw=(typeof y=="function")?y:y.code;this.parent=function(){}};c.rotate=function(y){return function(){var z=y.rotation();y.rotation(z<6.1?z+0.1:0)}};d.Action=c;d.Animate=t;d.Clip=a;d.DisplayObject=x;d.Draw=o;d.Image=v;d.Property=k;d.Range=u;d.Rect=j;d.Sprite=m;d.Spritesheet=w;d.Text=q;d.Util=g})(this,document);